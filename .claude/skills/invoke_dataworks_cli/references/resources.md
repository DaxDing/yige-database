# DataWorks 资源管理

## 资源组

### 资源组类型

| 类型 | 说明 | 计费 |
|------|------|------|
| **公共资源组** | 共享资源，按量付费 | 按 CU 时 |
| **独享资源组** | 独占资源，包年包月 | 固定费用 |
| **Serverless 资源组** | 弹性伸缩 | 按实际使用 |

### Serverless 资源组特点

| 特性 | 说明 |
|------|------|
| 启动时间 | 冷启动约 10-30 秒 |
| 运行环境 | 容器化，每次新环境 |
| 预装软件 | 精简环境，无 jq |
| Shell | `/bin/sh` (POSIX) |
| 网络 | 需配置白名单 |

### 资源组选择

**调度配置 → 资源组**

- 数据开发：选择计算资源组
- 数据集成：选择数据集成资源组

## 数据源

### 创建数据源

**路径**：管理中心 → 数据源 → 新增数据源

### 常见数据源类型

| 类型 | 说明 |
|------|------|
| MySQL | 关系型数据库 |
| PostgreSQL | 关系型数据库 |
| MaxCompute | 阿里云大数据计算 |
| Hologres | 实时数仓 |
| OSS | 对象存储 |
| RestAPI | HTTP 接口 |
| Kafka | 消息队列 |

### PostgreSQL 数据源配置

| 配置项 | 说明 |
|--------|------|
| 数据源名称 | 唯一标识 |
| 数据源类型 | PostgreSQL |
| 环境 | 开发/生产 |
| 连接地址 | VPC 地址或公网地址 |
| 端口 | 默认 5432 |
| 数据库 | 数据库名 |
| 用户名 | 数据库用户 |
| 密码 | 数据库密码 |

### RestAPI 数据源配置

| 配置项 | 说明 |
|--------|------|
| 数据源名称 | 唯一标识 |
| Base URL | API 基础地址 |
| 认证方式 | None/Basic/Token |
| 默认 Header | 公共请求头 |

### 网络配置

**VPC 网络**：
- 数据源使用 VPC 内网地址
- 需配置资源组与数据源 VPC 连通
- 安全但配置复杂

**公网**：
- 数据源使用公网地址
- 需添加资源组出口 IP 白名单
- 简单但需注意安全

## 文件资源

### 资源类型

| 类型 | 说明 | 用途 |
|------|------|------|
| JAR | Java 包 | UDF、自定义函数 |
| Python | Python 脚本 | PyODPS |
| File | 普通文件 | 配置文件 |
| Archive | 压缩包 | 依赖包 |

### 上传资源

**路径**：数据开发 → 资源 → 新建资源

### 引用资源

**ODPS SQL**：
```sql
-- 注册资源
add jar your_udf.jar;
-- 创建函数
create function my_udf as 'com.example.MyUDF' using 'your_udf.jar';
-- 使用函数
select my_udf(column) from table;
```

**Shell 节点**：
```sh
# 资源会被下载到工作目录
cat config.json
python3 script.py
```

## 函数

### 系统函数

DataWorks 内置函数，可直接使用。

### 自定义函数 (UDF)

**创建步骤**：
1. 上传 JAR 资源
2. 新建函数
3. 关联 JAR 和类名
4. 在 SQL 中使用

### 常用系统函数

| 函数 | 说明 |
|------|------|
| `TO_DATE` | 日期转换 |
| `DATEADD` | 日期加减 |
| `DATEDIFF` | 日期差 |
| `CONCAT` | 字符串连接 |
| `SPLIT` | 字符串分割 |
| `GET_JSON_OBJECT` | JSON 提取 |

## 凭证管理

### 加密参数

敏感信息（密码、Token）应使用加密参数：

**配置**：管理中心 → 凭证管理 → 新建凭证

**引用**：
```
# 工作流参数
DB_PASSWORD=${credential:db_password}
```

### 最佳实践

| 信息类型 | 存储方式 |
|---------|---------|
| 数据库密码 | 数据源配置（加密） |
| API Secret | 凭证管理 |
| 业务配置 | 工作流参数 |
| 临时 Token | 赋值节点生成 |
